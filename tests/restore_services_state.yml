# SPDX-License-Identifier: MIT
---
- name: Get final state of services
  tags: tests::cleanup
  service_facts:
  register: final_state

# yamllint disable rule:line-length
- name: Restore state of services
  tags: tests::cleanup
  service:
    name: "{{ item }}"
    # noqa args[module]
    state: "{{ 'started' if initial_state.ansible_facts.services[item + '.service']['state'] == 'running' else 'stopped' }}"
  when:
    - item + '.service' in final_state.ansible_facts.services
    - item + '.service' in initial_state.ansible_facts.services
    - initial_state.ansible_facts.services[item + '.service'].status != "not-found"
  with_items:
    - pmcd
    - pmlogger
    - pmie
    - pmproxy
    - redis
    - grafana-server
# yamllint enable rule:line-length
